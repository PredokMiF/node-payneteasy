"use strict";

/* Описание работы с массивами.
 */

var _ = require('lodash-node');

var v = require('../app');

module.exports = {
    // Проверяем что валидация по объекту работает
    'test-arr-0fc11608-e96f-4c7a-90b1-e2acc7d9e90f': function (test) {
        var tpl = v(['arr', 'n']);
        tpl([1,2,3]).
            then(function (result) {
                test.deepEqual(result, [1,2,3]);
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-arr-27241025-1a61-4f9e-9f03-fb8cb1c2b2f9': function (test) {
        var tpl = v(['array', 'n']);
        tpl([1,2,3]).
            then(function (result) {
                test.deepEqual(result, [1,2,3]);
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-arr-96e0265c-b968-40e8-8a34-26a31613ec63': function (test) {
        var tpl = v(['arr', 's']);
        tpl(['1','2','3']).
            then(function (result) {
                test.deepEqual(result, ['1','2','3']);
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-arr-0bf112d1-acb0-4c07-9675-01303af68531': function (test) {
        var tpl = v(['arr', 's']);
        tpl([]).
            then(function (result) {
                test.deepEqual(result, []);
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-arr-792bb29e-ee62-4f59-af53-be51520160d3': function (test) {
        var tpl = v(['arr', {q: 'n'}]);
        tpl([]).
            then(function (result) {
                test.deepEqual(result, []);
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-arr-b6bdc33f-401a-4473-859c-11a78bd3e06b': function (test) {
        var tpl = v(['arr', {q: 'n'}]);
        tpl([{q:3}, {q:0}]).
            then(function (result) {
                test.deepEqual(result, [{q:3}, {q:0}]);
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-arr-c4ef977e-7723-4fcb-a822-5a7e725d00df': function (test) {
        var tpl = v(['arr', ['obj soft', {q: 'n'}]]);
        tpl([{q:3}, {q:0, a:'ee'}]).
            then(function (result) {
                test.deepEqual(result, [{q:3}, {q:0, a:'ee'}]);
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-arr-bdd6f317-c7a6-4ff8-b77a-cd2442df618d': function (test) {
        var tpl = v(['arr', ['obj soft', {q: 'n'}], function (val, tpl, cfg) { return _.isArray(val) && val.length === 1 && _.isPlainObject(val[0]) && val[0].q === 3; }]);
        tpl([{q:3}]).
            then(function (result) {
                test.deepEqual(result, [{q:3}]);
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    // Ломаем
    'test-arr-85b80be8-5b34-4628-af6b-0af473004460': function (test) {
        var tpl = v(['arr', 'sr']);
        tpl().
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-arr-fc7dc49a-c996-46de-94bc-1435ed6cf648': function (test) {
        var tpl = v(['arr', ['obj soft', {q: 'n'}], function (val, tpl, cfg) { return !(_.isArray(val) && val.length === 1 && _.isPlainObject(val[0]) && val[0].q === 3); }]);
        tpl([{q:3}]).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },

};