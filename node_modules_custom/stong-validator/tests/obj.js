"use strict";

/* Описание работы с объектами.
 * В валидатор можно передать объект валидации:
 * var tpl = v({q:s});
 * tpl({q:'qwe'}).
 *      then(function (result) {
 *          // Валидация пройдена
 *      }, function (err) {
 *          // Валидация свалилась с ошибкой
 *      }).done(function () {
 *          // Выполнится в любом случае
 *      });
 * По умолчанию применяется жесткая проверка, т.е. любой ключ не объявленный в шаблоне является ошибкой
 * н.р.:
 *      var tpl = v({q:'s'});
 *      tpl({q:'qwe'}) // Норм
 *      tpl({q:'qwe', e:1}) // Ошибка
 *
 * Так же можно передать массив, первый элемент - строка с описание и настройками, вторая - шаблон, 3 и последующие - валидаторы
 * Первый параметр (строка) и валидаторы могут быть опущены
 */

var _ = require('lodash-node');

var v = require('../app');

module.exports = {
    // Проверяем что валидация по объекту работает
    'test-obj-72421226-c32e-4945-ae40-9ba7802cbc94': function (test) {
        var tpl = v([{q: 's'}]);
        tpl({q:'qwe'}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe'});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-d649663f-ca8f-44c5-835b-05e0afd78697': function (test) {
        var tpl = v(['obj', {q: 's'}]);
        tpl({q:'qwe'}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe'});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-8baf893c-b48b-4e03-8b72-e822d1578031': function (test) {
        var tpl = v(['obj', {q: 's'}]);
        tpl({q:'qwe'}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe'});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-bb4ab914-ca9a-4e41-af72-93ce9fcdb7cf': function (test) {
        var tpl = v(['object', {q: 's'}]);
        tpl({q:'qwe'}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe'});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-0223b507-18d2-4b31-9609-67813db280a8': function (test) {
        var tpl = v(['object', {q: 's'}, function (obj, tpl, cfg) { return _.isPlainObject(obj) && obj.q === 'qwe'; }]);
        tpl({q:'qwe'}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe'});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-9d384789-1bb5-442b-8c74-e3f386792fd0': function (test) {
        var tpl = v({q: 's'});
        tpl({q:'qwe'}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe'});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-e8dcb6f6-3096-4d48-a5a9-128f3f1f4201': function (test) {
        var tpl = v({q: 's', d: 'n'});
        tpl({q:'qwe', d: 2}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe', d: 2});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-573b5de4-a974-43a4-8361-2b993aafb28a': function (test) {
        var tpl = v({q: 's', d: 'n', r: 'b'});
        tpl({q:'qwe', d: 2, r: true}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe', d: 2, r: true});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-bceba561-ec45-4511-88e5-e11228ad28c7': function (test) {
        var tpl = v({q: 's', w: 'n', r: 'b'});
        tpl({}).
            then(function (result) {
                test.deepEqual(result, {});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-dddf2b76-f5dc-4e9c-ad56-b05f009d6890': function (test) {
        var tpl = v({q: 's reqKey', w: 'n reqKey', r: 'b reqKey'});
        tpl({q:'qwe', w: 2, r: true}).
            then(function (result) {
                test.deepEqual(result, {q:'qwe', w: 2, r: true});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-a6050b50-319b-4530-87cd-fab71dcc41f8': function (test) {
        var tpl = v({q: 's reqKey', w: 'n reqKey', r: 'b reqKey'});
        tpl({q:'', w: 0, r: false}).
            then(function (result) {
                test.deepEqual(result, {q:'', w: 0, r: false});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-552a7cae-4658-4e35-9e81-85d049a69e8f': function (test) {
        var tpl = v({q: 's reqKey toStr', w: 'n reqKey', r: 'b reqKey'});
        tpl({q:null, w: 0, r: false}).
            then(function (result) {
                test.deepEqual(result, {q:'', w: 0, r: false});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-3f34167a-28e9-45ed-8a82-2f747f060fee': function (test) {
        var tpl = v({q: 's reqKey toStr', w: 'n', r: 'b'});
        tpl({q:null}).
            then(function (result) {
                test.deepEqual(result, {q: ''});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-8ae653ee-b141-4b46-8ceb-68e3f21f8f78': function (test) {
        var tpl = v({a: {b: {c: {d: 'n'}}}});
        tpl({a:{b:{c:{d:1}}}}).
            then(function (result) {
                test.deepEqual(result, {a:{b:{c:{d:1}}}});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-3941afbd-80ab-41b3-b065-55f93f131e26': function (test) {
        var tpl = v(['obj soft', {a: 's', b: 'n'}]);
        tpl({a: 'e', c: true}).
            then(function (result) {
                test.deepEqual(result, {a: 'e', c: true});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-05d9bf54-3d3f-4d0f-9ab1-3a77cf640d95': function (test) {
        var tpl = v({a: 'any', b: 'dict v 1,2,5'});
        tpl({}).
            then(function (result) {
                test.deepEqual(result, {});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-4bdefa30-01bf-43bb-ab65-c3748b8f8f4b': function (test) {
        var tpl = v({a: 'any reqKey', b: 'dict reqKey v 1,2,5'});
        tpl({a: null, b: '5'}).
            then(function (result) {
                test.deepEqual(result, {a: null, b: '5'});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-66a19165-5eed-4739-89d5-14364aba1bfb': function (test) {
        var tpl = v({a: 'any reqKey', b: 'dict v 1,2,5 reqKey'});
        tpl({a: null, b: '5'}).
            then(function (result) {
                test.deepEqual(result, {a: null, b: '5'});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-33d4d907-67f2-47d2-8eba-db7dd6c19f64': function (test) {
        var tpl = v({a: ['obj reqKey', {b:'n'}]});
        tpl({a: {b: 5}}).
            then(function (result) {
                test.deepEqual(result, {a: {b: 5}});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    'test-obj-8a385667-a248-49cf-b19d-39b25c124424': function (test) {
        var tpl = v({a: ['obj reqKey', {b:'n reqKey'}]});
        tpl({a: {b: 5}}).
            then(function (result) {
                test.deepEqual(result, {a: {b:5}});
            }, function (err) {
                test.ok(false, 'Ошибки быть не должно: ' + err);
            }).done(function () { test.done(); });
    },
    // Ломаем
    'test-obj-ba41d397-9417-44f3-93fb-7fc1a5db5c67': function (test) {
        var tpl = v({q:'n'});
        tpl().
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-0f410f51-6b26-4ab6-bab2-301df3c3f157': function (test) {
        var tpl = v({q:'n'});
        tpl(undefined).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-e035a0d9-8de8-4642-8438-47dace56fe9a': function (test) {
        var tpl = v({q:'n'});
        tpl(null).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-a5da6174-e706-43ff-86dc-2bdea7b7b9f4': function (test) {
        var tpl = v({q:'n'});
        tpl({w:'wer'}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-56c192fa-454f-4349-b5c8-8efd90b7d3da': function (test) {
        var tpl = v({q:'n reqKey'});
        tpl({}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-73c70182-c1e6-47e3-84a1-e77f4f1def2a': function (test) {
        var tpl = v([{q:'n reqKey'}]);
        tpl({}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-da1c937b-38de-4eef-a73e-a58dbfc7f380': function (test) {
        var tpl = v([{q:'any reqKey'}]);
        tpl({}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-be3e7333-ab5b-4a75-b474-dfc8018b676e': function (test) {
        var tpl = v([{q:'dict reqKey'}]);
        tpl({}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-b6dcd246-3058-41b2-90ff-d2361451ef83': function (test) {
        var tpl = v({a: ['obj reqKey', {b:'n reqKey'}]});
        tpl({a: {}}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-653bc798-f707-48c4-8b22-f033b4a9bcd0': function (test) {
        var tpl = v({a: ['obj reqKey', {b:'n reqKey'}]});
        tpl({}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-71c56f86-0b09-42de-b9f9-fe3b8b6176e5': function (test) {
        var tpl = v({a: ['obj']});
        tpl({}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },
    'test-obj-8eabbd2b-38dc-44b3-b2bd-f50fd5ec5d15': function (test) {
        var tpl = v(['object', {q: 's'}, function (obj, tpl, cfg) { return _.isPlainObject(obj) && obj.q === 'qwe2'; }]);
        tpl({q:'qwe'}).
            then(function (result) {
                test.ok(false, 'Должна быть ошибка');
            }, function (err) {
                test.ok(err);
            }).done(function () { test.done(); });
    },

};